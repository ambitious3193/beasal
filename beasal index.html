<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>ğŸ“ é’ˆç¸ç©´ä½Â·å®Œæ•´è‡ªæµ‹ | åå››ç»+å¥‡ç©´</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'åæ–‡ç»†é»‘', sans-serif;
        }
        body {
            background: #ecf0e7;
            min-height: 100vh;
            padding: 12px;
            display: flex;
            justify-content: center;
        }
        .app {
            max-width: 520px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        /* é¡¶æ  è¿›åº¦ */
        .top-bar {
            background: white;
            padding: 12px 18px;
            border-radius: 48px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.02);
            border: 1px solid #c8d0b5;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .logo h1 {
            font-size: 1.5rem;
            font-weight: 550;
            color: #2b4f2b;
            letter-spacing: -0.2px;
        }
        .progress-badge {
            background: #e3ecd6;
            border-radius: 40px;
            padding: 6px 18px;
            display: flex;
            gap: 20px;
            font-size: 0.95rem;
        }
        .progress-item {
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }
        .dot-master { width: 10px; height: 10px; background: #2d6e2d; border-radius: 10px; }
        .dot-learning { width: 10px; height: 10px; background: #f0b849; border-radius: 10px; }
        .badge-num { font-weight: 600; margin-left: 2px; }

        /* æŠ½å–æŒ‰é’®è¡Œ */
        .draw-row {
            display: flex;
            gap: 8px;
            margin: 6px 0 2px;
        }
        .draw-btn {
            flex: 1;
            background: white;
            border: 1px solid #b6c4a0;
            border-radius: 48px;
            padding: 12px 0;
            font-size: 1.1rem;
            font-weight: 500;
            color: #1d3b1d;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            cursor: pointer;
            transition: 0.1s;
            text-align: center;
        }
        .draw-btn.primary {
            background: #3a6b3a;
            border-color: #1e421e;
            color: white;
            box-shadow: 0 5px 10px #3a6b3a55;
        }
        .draw-btn.primary:active { background: #2b532b; }
        .draw-btn:active { background: #deecd0; }

        /* æœ¬æ¬¡æŠ½ä¸­å¡ç‰‡ */
        .current-card {
            background: #f6f9ee;
            border-radius: 48px;
            padding: 22px 18px;
            border: 2px solid #c1d2a8;
            text-align: center;
        }
        .current-label {
            font-size: 1rem;
            color: #617554;
            margin-bottom: 8px;
        }
        #singleContainer .current-point {
            font-size: 2.6rem;
            font-weight: 550;
            color: #1d451d;
            line-height: 1.2;
            word-break: break-word;
        }
        .multi-points-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            max-height: 240px;
            overflow-y: auto;
            padding: 10px 4px;
        }
        .point-chip {
            background: white;
            border-radius: 40px;
            padding: 10px 22px;
            border: 1px solid #9fb280;
            font-size: 1.2rem;
            font-weight: 480;
            color: #1d3f1d;
            box-shadow: 0 2px 6px #c0bb9c;
            white-space: nowrap;
        }

        /* ç»Ÿè®¡æ’è¡Œ */
        .rank-section {
            background: #fefcf2;
            border-radius: 40px;
            border: 1px solid #d2cbae;
            padding: 16px 14px;
        }
        .rank-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            color: #3f5a3f;
            font-weight: 500;
            font-size: 1rem;
        }
        .rank-list {
            max-height: 210px;
            overflow-y: auto;
            background: #f4f7ea;
            border-radius: 30px;
            padding: 8px 10px;
            border: 1px solid #dad1b2;
        }
        .rank-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            border-bottom: 1px dashed #cec9aa;
            font-size: 0.95rem;
        }
        .rank-name {
            width: 100px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #2d472d;
        }
        .rank-bar-bg {
            flex: 1;
            height: 18px;
            background: #dbd6b5;
            border-radius: 40px;
            overflow: hidden;
        }
        .rank-bar-fill {
            height: 18px;
            background: #558b55;
            border-radius: 40px;
            width: 0%;
            transition: width 0.2s;
        }
        .rank-count {
            min-width: 35px;
            text-align: right;
            font-weight: 500;
            color: #235023;
        }

        /* ç©´ä½åº“ + å·¥å…·æ  */
        .library-panel {
            background: #fefcf2;
            border-radius: 40px;
            border: 1px solid #d2cbae;
            padding: 18px 14px;
        }
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
            align-items: center;
        }
        .search-box {
            flex: 2;
            min-width: 160px;
            background: white;
            border: 1px solid #bcb48c;
            border-radius: 40px;
            padding: 10px 16px;
            font-size: 0.95rem;
        }
        .icon-btn {
            background: white;
            border: 1px solid #bcb48c;
            border-radius: 40px;
            padding: 10px 14px;
            font-size: 0.9rem;
            cursor: pointer;
            white-space: nowrap;
        }
        .icon-btn:active { background: #dee9d1; }
        .danger-btn { border-color: #c5956e; color: #774d2e; }
        .danger-btn:active { background: #fbefe3; }

        /* ç©´ä½ç½‘æ ¼ ä¸¤åˆ— */
        .point-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
            padding: 4px 2px;
        }
        .point-item {
            background: #fcfcf2;
            border-radius: 40px;
            padding: 8px 12px;
            border: 1px solid #cbc09b;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }
        .point-item:active { background: #e2ecce; }
        .point-name {
            color: #2f462f;
            font-weight: 440;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 90px;
        }
        .point-count-pill {
            background: #dad0b2;
            border-radius: 30px;
            padding: 2px 8px;
            font-size: 0.7rem;
            font-weight: 600;
            color: #2c4f2c;
        }

        /* å¯¼å…¥åŒºåŸŸ */
        .import-area {
            background: #f9f6e7;
            border-radius: 30px;
            padding: 15px;
            margin-top: 15px;
            border: 1px dashed #b8a77b;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .import-area textarea {
            width: 100%;
            border: 1px solid #cbbf9a;
            border-radius: 28px;
            padding: 12px 16px;
            font-size: 0.9rem;
            resize: vertical;
        }

        .delete-hint {
            background: #fffbeb;
            border-radius: 30px;
            padding: 8px 16px;
            color: #8c6e4b;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }
        .small-btn {
            background: white;
            border: 1px solid #bcb48c;
            border-radius: 30px;
            padding: 5px 15px;
            font-size: 0.85rem;
        }
        .footer-note {
            color: #746e52;
            font-size: 0.85rem;
            text-align: center;
            background: #f0ead9;
            padding: 10px;
            border-radius: 30px;
            margin-top: 8px;
        }
    </style>
</head>
<body>
<div class="app">
    <!-- é¡¶æ  è¿›åº¦ -->
    <div class="top-bar">
        <div class="logo"><h1>ğŸ“ é’ˆç¸ç©´ä½Â·åå››ç»</h1></div>
        <div class="progress-badge" id="progressDisplay">
            <div class="progress-item"><span class="dot-master"></span><span id="masterCount">0</span></div>
            <div class="progress-item"><span class="dot-learning"></span><span id="learningCount">250</span></div>
        </div>
    </div>

    <!-- æŠ½å–æŒ‰é’®ä¸‰å…„å¼Ÿ -->
    <div class="draw-row">
        <button class="draw-btn primary" id="drawSingleBtn">å•ç©´</button>
        <button class="draw-btn" id="drawFiveBtn">äº”ç©´</button>
        <button class="draw-btn" id="drawTenBtn">åç©´</button>
    </div>

    <!-- æœ¬æ¬¡æŠ½ä¸­å¡ç‰‡ -->
    <div class="current-card" id="currentCard">
        <div class="current-label" id="currentLabel">æœ¬æ¬¡æŠ½ä¸­</div>
        <!-- å•ç©´å®¹å™¨ -->
        <div id="singleContainer">
            <div class="current-point" id="currentPoint">â€”â€”</div>
        </div>
        <!-- å¤šç©´å®¹å™¨ (è¿æŠ½æ—¶æ˜¾ç¤º) -->
        <div id="multiContainer" class="multi-points-container" style="display: none;"></div>
    </div>

    <!-- ç»Ÿè®¡æ’è¡Œå¡ç‰‡ -->
    <div class="rank-section">
        <div class="rank-header">
            <span>ğŸ“Š æŠ½ä¸­æ’è¡Œ</span>
            <span style="font-size:0.8rem;">ç‚¹å‡»ç©´åå¯å†æŠ½</span>
        </div>
        <div class="rank-list" id="rankList">
            <div style="padding:16px; text-align:center; color:#aaa;">æš‚æ— æŠ½ç­¾è®°å½•</div>
        </div>
    </div>

    <!-- ç©´ä½åº“ + ç¼–è¾‘å·¥å…· -->
    <div class="library-panel">
        <div class="toolbar">
            <input type="text" class="search-box" id="searchInput" placeholder="ğŸ” æœç´¢ç©´ä½">
            <button class="icon-btn" id="openImportBtn">ğŸ“¥ å¯¼å…¥</button>
            <button class="icon-btn danger-btn" id="deleteModeToggle">âœï¸ åˆ é™¤</button>
        </div>

        <!-- ç©´ä½ç½‘æ ¼ -->
        <div class="point-grid" id="pointGrid"></div>

        <!-- å¯¼å…¥åŒºåŸŸ -->
        <div class="import-area" id="importArea" style="display: none;">
            <textarea id="bulkInput" rows="2" placeholder="è¾“å…¥ç©´ä½åï¼Œç”¨é€—å·/ç©ºæ ¼/æ¢è¡Œéš”å¼€"></textarea>
            <div style="display: flex; gap: 8px;">
                <button class="icon-btn" id="confirmImportBtn" style="flex:2;">âœ… ç¡®è®¤</button>
                <button class="icon-btn" id="cancelImportBtn">å–æ¶ˆ</button>
            </div>
        </div>

        <!-- åˆ é™¤æ¨¡å¼æç¤º -->
        <div class="delete-hint" id="deleteHint" style="display: none;">
            <span>ğŸ—‘ï¸ ç‚¹å‡»ç©´ä½åº“ä¸­çš„ç©´ä½å¯åˆ é™¤</span>
            <button class="small-btn" id="exitDeleteMode">å®Œæˆ</button>
        </div>

        <div style="display: flex; gap: 8px; margin-top: 12px;">
            <button class="icon-btn" id="resetStatsBtn" style="flex:1;">ğŸ“‰ é‡ç½®ç»Ÿè®¡</button>
            <button class="icon-btn" id="resetToDefaultBtn" style="flex:1;">â†º æ¢å¤é»˜è®¤</button>
        </div>
        <div class="footer-note">ç‚¹å‡»ç©´åå¿«é€Ÿ+1 Â· ç­‰æ¦‚ç‡æŠ½ç­¾ Â· å…¨ç»ç©´+å¥‡ç©´</div>
    </div>
</div>

<script>
(function() {
    // ---------- å®Œæ•´ç©´ä½åº“ (æ ¹æ®ç”¨æˆ·æä¾›çš„åˆ—è¡¨) ----------
    const DEFAULT_POINTS = [
        // æ‰‹å¤ªé˜´è‚ºç» 11ç©´
        "ä¸­åºœ", "å°ºæ³½", "å­”æœ€", "åˆ—ç¼º", "å¤ªæ¸Š", "é±¼é™…", "å°‘å•†",
        // æ‰‹é˜³æ˜å¤§è‚ ç» 20ç©´
        "å•†é˜³", "åˆè°·", "é˜³æºª", "åå†", "æ‰‹ä¸‰é‡Œ", "æ›²æ± ", "è‡‚è‡‘", "è‚©é«ƒ", "æ‰¶çª", "è¿é¦™",
        // è¶³é˜³æ˜èƒƒç» 45ç©´
        "æ‰¿æ³£", "å››ç™½", "åœ°ä»“", "é¢Šè½¦", "ä¸‹å…³", "å¤´ç»´", "äººè¿", "æ¢é—¨", "å¤©æ¢", "æ°´é“", "å½’æ¥", "ä¼å…”", "æ¢ä¸˜", "è¶³ä¸‰é‡Œ", "ä¸Šå·¨è™š", "æ¡å£", "ä¸‹å·¨è™š", "ä¸°éš†", "è§£æºª", "å†…åº­", "å‰å…‘",
        // è¶³å¤ªé˜´è„¾ç» 21ç©´
        "éšç™½", "å¤ªç™½", "å…¬å­™", "ä¸‰é˜´äº¤", "åœ°æœº", "é˜´é™µæ³‰", "è¡€æµ·", "å¤§æ¨ª", "å¤§åŒ…",
        // æ‰‹å°‘é˜´å¿ƒç» 9ç©´
        "ææ³‰", "å°‘æµ·", "é€šé‡Œ", "é˜´éƒ„", "ç¥é—¨", "å°‘åºœ", "å°‘å†²",
        // æ‰‹å¤ªé˜³å°è‚ ç» 19ç©´
        "å°‘æ³½", "åæºª", "è…•éª¨", "å…»è€", "æ”¯æ­£", "å°æµ·", "è‚©è´", "å¤©å®—", "é¢§é«", "å¬å®«",
        // è¶³å¤ªé˜³è†€èƒ±ç» 67ç©´ (ç”¨æˆ·æä¾›)
        "ç›æ˜", "æ”’ç«¹", "å¤©æŸ±", "å¤§æ¼", "é£é—¨", "è‚ºä¿", "å¿ƒä¿", "è†ˆä¿", "è‚ä¿", "èƒ†ä¿", "è„¾ä¿", "èƒƒä¿", "ä¸‰ç„¦ä¿", "è‚¾ä¿", "å¤§è‚ ä¿", "å°è‚ ä¿", "è†€èƒ±ä¿", "æ¬¡é«", "æ‰¿æ‰¶", "å§”é˜³", "å§”ä¸­", "è†è‚“", "å¿—å®¤", "ç§©è¾¹", "æ‰¿å±±", "é£æ‰¬", "æ˜†ä»‘", "ç”³è„‰", "æŸéª¨", "è‡³é˜´",
        // è¶³å°‘é˜´è‚¾ç» 27ç©´
        "æ¶Œæ³‰", "ç„¶è°·", "å¤ªæºª", "å¤§é’Ÿ", "ç…§æµ·", "å¤æºœ", "é˜´è°·", "å¤§èµ«", "è‚“ä¿",
        // æ‰‹å¥é˜´å¿ƒåŒ…ç» 9ç©´
        "å¤©æ± ", "æ›²æ³½", "éƒ„é—¨", "é—´ä½¿", "å†…å…³", "å¤§é™µ", "åŠ³å®«", "ä¸­å†²",
        // æ‰‹å°‘é˜³ä¸‰ç„¦ç» 23ç©´
        "å…³å†²", "ä¸­æ¸š", "é˜³æ± ", "å¤–å…³", "æ”¯æ²Ÿ", "è‚©é«", "ç¿³é£", "è§’å­™", "è€³é—¨", "ä¸ç«¹ç©º",
        // è¶³å°‘é˜³èƒ†ç» 44ç©´
        "ç³å­é«", "å¬ä¼š", "ç‡è°·", "å®Œéª¨", "é˜³ç™½", "å¤´ä¸´æ³£", "é£æ± ", "è‚©äº•", "æ—¥æœˆ", "å¸¦è„‰", "ç¯è·³", "é£å¸‚", "é˜³é™µæ³‰", "å…‰æ˜", "æ‚¬é’Ÿ", "ä¸˜å¢Ÿ", "è¶³ä¸´æ³£", "ä¾ æºª", "è¶³çªé˜´",
        // è¶³å¥é˜´è‚ç» 14ç©´
        "å¤§æ•¦", "è¡Œé—´", "å¤ªå†²", "è ¡æ²Ÿ", "æ›²æ³‰", "ç« é—¨", "æœŸé—¨",
        // ç£è„‰ 29ç©´
        "é•¿å¼º", "è…°é˜³å…³", "å‘½é—¨", "è‡³é˜³", "èº«æŸ±", "å¤§æ¤", "å“‘é—¨", "é£åºœ", "ç™¾ä¼š", "ä¸Šæ˜Ÿ", "ç¥åº­", "ç´ é«", "æ°´æ²Ÿ", "å°å ‚",
        // ä»»è„‰ 24ç©´
        "ä¸­æ", "å…³å…ƒ", "æ°”æµ·", "ç¥é˜™", "ä¸‹è„˜", "å»ºé‡Œ", "ä¸­è„˜", "ä¸Šè„˜", "è†»ä¸­", "å¤©çª", "å»‰æ³‰", "æ‰¿æµ†",
        // ç»å¤–å¥‡ç©´ å¤´é¢ˆéƒ¨
        "å››ç¥èª", "å¤ªé˜³", "çƒå", "é‡‘æ´¥ã€ç‰æ¶²", "å¤¹æ‰¿æµ†", "ç‰µæ­£", "ç¿³æ˜", "å®‰çœ ",
        // èƒ¸è…¹éƒ¨
        "å­å®«", "ä¸‰è§’ç¸",
        // èƒŒéƒ¨
        "å®šå–˜", "å¤¹è„Š", "èƒƒè„˜ä¸‹ä¿", "è…°çœ¼",
        // ä¸Šè‚¢éƒ¨
        "è‚©å‰", "äºŒç™½", "è…°ç—›ç‚¹", "å¤–åŠ³å®«", "å…«é‚ª", "å››ç¼", "åå®£",
        // ä¸‹è‚¢éƒ¨
        "é¹¤é¡¶", "ç™¾è™«çª", "å†…è†çœ¼", "èƒ†å›Š", "é˜‘å°¾", "å…«é£"
    ];

    // å»é‡ (ç¡®ä¿æ— é‡å¤)
    const FINAL_POINTS = [...new Set(DEFAULT_POINTS)];

    // å½“å‰ç©´ä½åº“ & é¢‘ç‡
    let pointList = [...FINAL_POINTS];
    let freqMap = new Map();

    // UI å…ƒç´ 
    const currentPointSpan = document.getElementById('currentPoint');
    const singleContainer = document.getElementById('singleContainer');
    const multiContainer = document.getElementById('multiContainer');
    const currentLabel = document.getElementById('currentLabel');
    const rankListDiv = document.getElementById('rankList');
    const pointGridDiv = document.getElementById('pointGrid');
    const searchInput = document.getElementById('searchInput');
    const masterSpan = document.getElementById('masterCount');
    const learningSpan = document.getElementById('learningCount');

    const drawSingle = document.getElementById('drawSingleBtn');
    const drawFive = document.getElementById('drawFiveBtn');
    const drawTen = document.getElementById('drawTenBtn');
    const resetStatsBtn = document.getElementById('resetStatsBtn');
    const resetDefaultBtn = document.getElementById('resetToDefaultBtn');
    const openImportBtn = document.getElementById('openImportBtn');
    const importArea = document.getElementById('importArea');
    const bulkInput = document.getElementById('bulkInput');
    const confirmImport = document.getElementById('confirmImportBtn');
    const cancelImport = document.getElementById('cancelImportBtn');
    const deleteModeToggle = document.getElementById('deleteModeToggle');
    const deleteHint = document.getElementById('deleteHint');
    const exitDeleteMode = document.getElementById('exitDeleteMode');

    let deleteModeActive = false;

    // åˆ·æ–°UI
    function refreshUI() {
        const searchTerm = searchInput.value.trim().toLowerCase();
        const filtered = pointList.filter(p => p.toLowerCase().includes(searchTerm));
        let gridHtml = '';
        if (filtered.length === 0) {
            gridHtml = '<div style="grid-column:1/-1; text-align:center; padding:20px; color:#8e8b70;">ğŸŒ± æ— åŒ¹é…ç©´ä½</div>';
        } else {
            filtered.forEach(p => {
                const cnt = freqMap.get(p) || 0;
                gridHtml += `<div class="point-item" data-point="${p}">
                    <span class="point-name">${p}</span>
                    <span class="point-count-pill">${cnt}</span>
                </div>`;
            });
        }
        pointGridDiv.innerHTML = gridHtml;

        // æ’è¡Œ
        const sorted = Array.from(freqMap.entries()).sort((a,b) => b[1] - a[1]);
        let rankHtml = '';
        if (sorted.length === 0) {
            rankHtml = '<div style="padding:16px; text-align:center; color:#aaa;">æš‚æ— æŠ½ç­¾è®°å½•</div>';
        } else {
            const maxCount = sorted[0][1] || 1;
            sorted.forEach(([p, cnt]) => {
                const percent = (cnt / maxCount) * 100;
                rankHtml += `<div class="rank-item">
                    <span class="rank-name">${p}</span>
                    <div class="rank-bar-bg"><div class="rank-bar-fill" style="width:${percent}%;"></div></div>
                    <span class="rank-count">${cnt}</span>
                </div>`;
            });
        }
        rankListDiv.innerHTML = rankHtml;

        // æŒæ¡/æœªæŒæ¡ (æŠ½è¿‡ä¸€æ¬¡å°±ç®—æŒæ¡)
        const total = pointList.length;
        const mastered = new Set(Array.from(freqMap.keys()).filter(p => pointList.includes(p))).size;
        masterSpan.textContent = mastered;
        learningSpan.textContent = total - mastered;

        // ç»‘å®šç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.point-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.stopPropagation();
                const p = item.dataset.point;
                if (!p) return;
                if (deleteModeActive) {
                    pointList = pointList.filter(x => x !== p);
                    freqMap.delete(p);
                    if (!pointList.includes(currentPointSpan.textContent) && currentPointSpan.textContent !== 'â€”â€”') {
                        currentPointSpan.textContent = 'â€”â€”';
                        singleContainer.style.display = 'block';
                        multiContainer.style.display = 'none';
                    }
                    refreshUI();
                } else {
                    manualDrawPoint(p);
                }
            });
        });

        // æ’è¡Œç‚¹å‡»
        document.querySelectorAll('.rank-item .rank-name').forEach(el => {
            el.addEventListener('click', (e) => {
                e.stopPropagation();
                const p = e.target.textContent;
                if (p && pointList.includes(p) && !deleteModeActive) manualDrawPoint(p);
            });
        });
    }

    function getRandomPoint() {
        if (pointList.length === 0) return null;
        return pointList[Math.floor(Math.random() * pointList.length)];
    }

    function manualDrawPoint(p) {
        if (!pointList.includes(p)) return;
        freqMap.set(p, (freqMap.get(p) || 0) + 1);
        singleContainer.style.display = 'block';
        multiContainer.style.display = 'none';
        currentPointSpan.textContent = p;
        currentLabel.textContent = 'æœ¬æ¬¡æŠ½ä¸­';
        refreshUI();
    }

    function drawSingleFunc() {
        const p = getRandomPoint();
        if (!p) return;
        freqMap.set(p, (freqMap.get(p) || 0) + 1);
        singleContainer.style.display = 'block';
        multiContainer.style.display = 'none';
        currentPointSpan.textContent = p;
        currentLabel.textContent = 'æœ¬æ¬¡æŠ½ä¸­';
        refreshUI();
    }

    function drawMultiple(n) {
        if (pointList.length === 0) return;
        const results = [];
        for (let i = 0; i < n; i++) {
            const p = getRandomPoint();
            if (p) {
                results.push(p);
                freqMap.set(p, (freqMap.get(p) || 0) + 1);
            }
        }
        multiContainer.innerHTML = '';
        results.forEach(p => {
            const chip = document.createElement('span');
            chip.className = 'point-chip';
            chip.textContent = p;
            multiContainer.appendChild(chip);
        });
        singleContainer.style.display = 'none';
        multiContainer.style.display = 'flex';
        currentLabel.textContent = `è¿æŠ½ ${n} ç©´`;
        refreshUI();
    }

    function resetStats() {
        freqMap.clear();
        singleContainer.style.display = 'block';
        multiContainer.style.display = 'none';
        currentPointSpan.textContent = 'â€”â€”';
        currentLabel.textContent = 'æœ¬æ¬¡æŠ½ä¸­';
        refreshUI();
    }

    function resetDefault() {
        pointList = [...FINAL_POINTS];
        freqMap.clear();
        singleContainer.style.display = 'block';
        multiContainer.style.display = 'none';
        currentPointSpan.textContent = 'â€”â€”';
        currentLabel.textContent = 'æœ¬æ¬¡æŠ½ä¸­';
        deleteModeActive = false; deleteHint.style.display = 'none';
        importArea.style.display = 'none';
        refreshUI();
    }

    function importBulk(text) {
        const parts = text.split(/[ï¼Œ,ã€\s\n]+/).filter(s => s.trim() !== '');
        if (parts.length === 0) return;
        const newPoints = [...new Set(parts)];
        pointList = newPoints;
        const newFreq = new Map();
        for (let [k, v] of freqMap.entries()) {
            if (pointList.includes(k)) newFreq.set(k, v);
        }
        freqMap = newFreq;
        singleContainer.style.display = 'block';
        multiContainer.style.display = 'none';
        currentPointSpan.textContent = 'â€”â€”';
        currentLabel.textContent = 'æœ¬æ¬¡æŠ½ä¸­';
        deleteModeActive = false; deleteHint.style.display = 'none';
        importArea.style.display = 'none';
        refreshUI();
    }

    // äº‹ä»¶ç»‘å®š
    drawSingle.addEventListener('click', drawSingleFunc);
    drawFive.addEventListener('click', () => drawMultiple(5));
    drawTen.addEventListener('click', () => drawMultiple(10));

    resetStatsBtn.addEventListener('click', resetStats);
    resetDefaultBtn.addEventListener('click', resetDefault);

    openImportBtn.addEventListener('click', () => {
        importArea.style.display = 'flex';
        importArea.style.flexDirection = 'column';
        deleteModeActive = false; deleteHint.style.display = 'none';
    });
    cancelImport.addEventListener('click', () => { importArea.style.display = 'none'; bulkInput.value = ''; });
    confirmImport.addEventListener('click', () => { importBulk(bulkInput.value); bulkInput.value = ''; });

    deleteModeToggle.addEventListener('click', () => {
        deleteModeActive = !deleteModeActive;
        deleteHint.style.display = deleteModeActive ? 'flex' : 'none';
        importArea.style.display = 'none';
    });
    exitDeleteMode.addEventListener('click', () => {
        deleteModeActive = false;
        deleteHint.style.display = 'none';
        refreshUI();
    });

    searchInput.addEventListener('input', refreshUI);

    // åˆå§‹åŒ–
    refreshUI();
})();
</script>
</body>
</html>